<%- include('layouts/header.ejs') , {udata:locals.udata} %>


      <main class="promain pb-5">
        <section class="products pt-5 pt-sm-5">
          <div class="container ">
              <div class="row p-4 p-sm-0">
                <h2 class="fw-bold my-4">ORDERS</h2>

                <% if(locals.orderdata && locals.orderdata.length > 0) { locals.orderdata.forEach(element => { %>
                <div class="card ordersmain p-0 my-4">
                    <div class="ordertitle"><h4>Order ID : #<%= element._id %></h4><div class="ordertitle2"><a href="/orders/summary?id=<%= element._id %>"><button type="button">View Order Summary</button></a>
                      <% if(element.status === "Delivered") { %>
                        <a href="/orders/return?id=<%= element._id %>"><button type="button">Return</button></a>
                        <% } else { %>
                          <button type="button" class="cancelorderbtn" data-orderid="<%= element._id %>">Cancel Order</button>
                          <% } %>
                      </div></div>
                    <% if(element.products && element.products.length > 0) { element.products.forEach(el => { %>
                    <div class="card-body orderscard ">
                        <img src="/assets/<%= el.product_id.mainimage %>" alt="" width="120px" height="120px">
                        <table class="table   table1">
                            <tr>
                                <th>Date</th>
                                <th>Product Name</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total Price</th>
                                <th>Status</th>
                            </tr>
                            <tr>
                                <td class="td1"><%= element.date.toString().split(' ')[2] %>&nbsp;<%= element.date.toString().split(' ')[1] %>&nbsp;<%= element.date.toString().split(' ')[3] %>&nbsp;</td>
                                <td class="td2"><%= el.product_id.productname %></td>
                                <td class="td3"><%= el.qty %></td>
                                <td class="td4">Rs.<%= el.product_id.price %></td>
                                <td class="td5">Rs.<%= el.qty * el.product_id.price %></td>
                                <td class="td6"> <% if(element.status === "Processing") { %>
                                  <span class="stat1">Processing</span>
                                  <% } else if(element.status === "Delivered") { %>
                                  <span class="stat">Delivered</span>
                                  <% } else if(element.status === "Dispatched") { %> 
                                  <span class="stat2">Dispatched</span>
                                  <% } else if(element.status === "Shipped") { %>
                                    <span class="stat3">Shipped</span>
                                  <% } else if(element.status === "Cancelled") { %>
                                    <span class="stat4">Cancelled</span>
                                  <% } %>
                                    
                                </td>
                            </tr>
                        </table>
                        <table class="table  table2" style="display: none;">
                            <tr><th>Date</th><td class="td1"><%= element.date.toString().split(' ')[2] %>&nbsp;<%= element.date.toString().split(' ')[1] %>&nbsp;<%= element.date.toString().split(' ')[3] %>&nbsp;</td></tr>
                            <tr><th>Product Name</th><td class="td2"><%= el.product_id.productname %></td></tr>
                            <tr><th>Quantity</th><td class="td3"><%= el.qty %></td></tr>
                            <tr><th>Unit Price</th><td class="td4">Rs.<%= el.product_id.price %></td></tr>
                            <tr><th>Total Price</th><td class="td5">Rs.<%= el.qty * el.product_id.price %></td></tr>
                            <tr><th>Status</th><td class="td6">
                              <% if(element.status === "Processing") { %>
                                <span class="stat1">Processing</span>
                                <% } else if(element.status === "Delivered") { %>
                                <span class="stat">Delivered</span>
                                <% } else if(element.status === "Dispatched") { %> 
                                <span class="stat2">Dispatched</span>
                                <% } else if(element.status === "Shipped") { %>
                                  <span class="stat3">Shipped</span>
                                <% } else if(element.status === "Cancelled") { %>
                                  <span class="stat4">Cancelled</span>
                                <% } %>
                              
                            </td></tr>
                        </table>
                    </div>
                    <%   }); } %>
                    <div class="ordertitle text-end justify-content-end pe-5"><h6 >Total Amount : Rs.<%= element.total_amount %></h6></div>

                </div>

                <%  }); } else { %>
                      <div class="card ordersmain p-0">
                          <div class="card-body orderscard">
                            <div class="card-title">No Orders Placed.</div>
                          </div>
                      </div>
                  <% } %>
              </div>
          </div>
      </section>
      </main>

<script src="/public/js/orders.js"></script>
<%- include('layouts/footer.ejs')  %>
